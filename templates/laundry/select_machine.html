{% extends "base.html" %}
{% block content %}
<h1>동 및 기계 선택</h1>
<label for="building">동 선택:</label>
<select id="building"></select>

<fieldset>
  <legend>기계 종류</legend>
  <label><input type="radio" name="type" value="washer" checked> 세탁기</label>
  <label><input type="radio" name="type" value="dryer"> 건조기</label>
</fieldset>

<button id="load-machines">조회</button>
<ul id="machine-list"></ul>

<script>
async function fetchBuildings() {
  const res = await fetch('/api/buildings/', {credentials:'include'});
  const data = await res.json();
  const sel = document.getElementById('building');
  data.forEach(b => {
    sel.innerHTML += `<option value="${b.id}">${b.name}동 (세탁기 ${b.washer_count}대, 건조기 ${b.dryer_count}대)</option>`;
  });
}

async function fetchMachines() {
  const bId = document.getElementById('building').value;
  const type = document.querySelector('input[name="type"]:checked').value;
  const res = await fetch(`/api/machines/?type=${type}&building=${bId}`, {credentials:'include'});
  const machines = await res.json();
  document.getElementById('machine-list').innerHTML = machines.map(m =>
    `<li>${m.building_name}동 ${m.name} — 사용중: ${m.is_in_use}</li>`
  ).join('');
}

window.onload = fetchBuildings;
document.getElementById('load-machines').onclick = fetchMachines;
</script>
{% endblock %}