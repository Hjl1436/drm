{% extends 'base.html' %}
{% load static %}

{% block content %}
<h1>동 및 기계 선택</h1>
<label for="building">동 선택:</label>
<select id="building"></select>

<fieldset>
  <legend>기계 종류</legend>
  <label><input type="radio" name="type" value="washer" checked> 세탁기</label>
  <label><input type="radio" name="type" value="dryer"> 건조기</label>
</fieldset>

<button id="load-machines">조회</button>
<ul id="machine-list"></ul>
{% endblock %}

{% block extra_js %}
<script src="{% static 'main.js' %}"></script>
<script>
async function fetchBuildings() {
  const res = await fetch("{% url 'laundry:building_counts' %}", { credentials: 'include' });
  const data = await res.json();
  const sel = document.getElementById('building');
  sel.innerHTML = '';
  data.forEach(b => {
    sel.innerHTML += `<option value="${b.building}">${b.building}동 (사용 중: ${b.count}대)</option>`;
  });
}

async function fetchMachines() {
  const bId = document.getElementById('building').value;
  const type = document.querySelector('input[name="type"]:checked').value;
  const res = await fetch("{% url 'laundry:get_machine_list_api' %}?type=" + type + "&building=" + bId, { credentials: 'include' });
  const machines = await res.json();
  const list = document.getElementById('machine-list');
  list.innerHTML = machines.map(m =>
    `<li>${m.building}동 ${m.name} — 사용중: ${m.is_in_use ? '예' : '아니오'}</li>`
  ).join('');
}

document.addEventListener('DOMContentLoaded', () => {
  fetchBuildings();
  document.getElementById('load-machines').addEventListener('click', fetchMachines);
});
</script>
{% endblock %}